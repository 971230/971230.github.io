---
title: è´£ä»»é“¾æ¨¡å¼
description: è´£ä»»é“¾æ¨¡å¼
# status: new
---

# è´£ä»»é“¾æ¨¡å¼

![å›¾ç‰‡çš„æ ·å¼](./img/chain-of-responsibility-2x.png)

<P style="text-indent:2em;">
è´£ä»»é“¾æ¨¡å¼é€‚åˆä¸šåŠ¡éœ€è¦æŒ‰æ­¥éª¤æ‰§è¡Œï¼Œä¸šåŠ¡å…·æœ‰å¾ˆæ˜æ˜¾çš„æµç¨‹æ€§ã€é¡ºåºæ€§ï¼Œä»»åŠ¡å‘é€è€…å’Œæ¥å—è€…éœ€è¦æ¾è€¦åˆçš„æƒ…å†µï¼Œ
ä¸“é—¨å¯¹æµç¨‹æ§åˆ¶å’Œå¤„ç†æ¥ä½¿ç”¨ã€‚
å®ƒä¸»è¦æ˜¯è¿˜æ˜¯æ¾è€¦åˆï¼Œå’Œå¤§å¤šæ•°è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œæ‰©å±•æ€§å¥½åˆçµæ´»ï¼Œå½“ç„¶å¦‚æœæµç¨‹å¾ˆé•¿ï¼Œè´£ä»»é“¾ä¸­è¯·æ±‚çš„å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œ
ä¸­é—´é‚£é‡Œæœ‰é—®é¢˜äº†ï¼Œä½ æ‰¾èµ·æ¥è¿˜éº»çƒ¦ã€‚
</p>

<P style="text-indent:2em;">
è¿™ä¸ªæ¨¡å¼åœ¨å„å¤§å¼€æºæ¡†æ¶éƒ½æœ‰å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚spring-cloud-gatewayæœ‰ä¸€ä¸ªFilteringWebHandlerï¼Œ
Spring Securityæœ‰ä¸€ä¸ªFilterChainProxyã€‚
ç®€å•ä¸€ç‚¹ï¼Œä¸¾ä¸ªä¾‹å­ï¼šSaaSç³»ç»Ÿé‡Œæœ‰ä¸€ä¸ªè¯·å‡æµç¨‹ï¼Œå…¬å¸çš„è¦æ±‚å¯èƒ½æ˜¯è¦è¾¾æˆæ€æ ·çš„æ­¥éª¤ï¼Œ
æœ€ç»ˆä½ æ‰å¯ä»¥æˆåŠŸã€‚
</p>

<img src="../img/duty-chain-ex.png"/>

<P style="text-indent:2em;">
åˆæˆ–è€…æœ‰ä¸€ä¸ªæ¥å£ï¼Œä½ è¦æ ¡éªŒå¾ˆå¤šä¸œè¥¿ï¼Œä½ è¦æ£€éªŒå‚æ•°ã€é»‘åå•ï¼Œä½ åˆè¦æ£€éªŒè§„åˆ™æ‹¦æˆªã€åšå®‰å…¨æ ¡éªŒï¼Œæ­£å¸¸æ˜¯å¦‚ä¸‹ï¼š
</p>

```java
@PostMapping("/xxx")
public void ä¸šåŠ¡æ¥å£(å‚æ•° å‚æ•°) {
    // 1.æ£€éªŒå‚æ•°
    // 2.æ ¡éªŒå®‰å…¨
    // 3.æ ¡éªŒé»‘åå•
    // 4.å†…éƒ¨è§„åˆ™
    // å¯èƒ½è¿˜æœ‰å…¶å®ƒ
}
```

<P style="text-indent:2em;">
é‚£è¿™æ ·æ˜¯æ™®é€šçš„å†™æ³•ï¼Œå®ƒèƒ½ç”¨ï¼Œä½†æ˜¯è¿èƒŒå¼€é—­åŸåˆ™ï¼Œå³å½“æˆ‘ä»¬æ‰©å±•åŠŸèƒ½çš„æ—¶å€™éœ€è¦å»ä¿®æ”¹ä¸»æµç¨‹ï¼Œæ— æ³•åšåˆ°å¯¹ä¿®æ”¹å…³é—­ã€å¯¹æ‰©å±•å¼€æ”¾ã€‚
è€Œä¸”å¦‚æœè¦ä¿®æ”¹é¡ºåºï¼Œè¿˜è¦æ”¹ä¸šåŠ¡æ¥å£é‡Œé¢çš„ä»£ç ã€‚
</p>

### ğŸ€ä»£ç æ ·ä¾‹

é‚£å¦‚ä½•æ”¹ä¸€ä¸‹å‘¢ï¼Ÿé¦–å…ˆè¦æœ‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒæŠŠæ ¡éªŒæˆ–æ‹¦æˆªçš„åŠ¨ä½œæŠ½å‡ºæ¥ã€‚

```java
@Getter
@Setter
public abstract class AbstractHandler {
    // è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡
    private AbstractHandler nextHandler;

    /**
     * å…·ä½“å‚æ•°æ‹¦æˆªé€»è¾‘,ç»™å­ç±»å»å®ç°,å‚æ•°å°±æ˜¯ä½ è¦æ ¡éªŒæˆ–æ‹¦æˆªçš„ä¸œè¥¿,å°±æ˜¯è´£ä»»é“¾è¦æ“ä½œçš„å¯¹è±¡
     */
    public void filter(int a, int b) {
        doFilter(a, b);
        if (getNextHandler() != null) {
            getNextHandler().filter(a, b);
        }
    }

    abstract void doFilter(int a, int b);
}
```

é‚£ä¹ˆæ¯ä¸€ä¸ªè¦æ ¡éªŒçš„å¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªå®ç°ç±»ï¼Œå¯¹åº”å¦‚ä¸‹ï¼š

=== "å‚æ•°æ ¡éªŒå¯¹è±¡"

    ```java
    @Component
    @Order(1) // é¡ºåºæ’ç¬¬1ï¼Œæœ€å…ˆæ ¡éªŒ
    public class CheckParamFilterObject extends AbstractHandler {
        @Override
        void doFilter(int a, int b) {
            System.out.println("æ¯”å¦‚éç©ºå‚æ•°æ£€æŸ¥...");
        }
    }
    ```

=== "å®‰å…¨æ ¡éªŒå¯¹è±¡"

    ```java
    @Component
    @Order(2) // æ ¡éªŒé¡ºåºæ’ç¬¬2
    public class CheckSecurityFilterObject extends AbstractHandler {
        @Override
        void doFilter(int a, int b) {
            System.out.println("å®‰å…¨è°ƒç”¨æ ¡éªŒ");
        }
    }
    ```

=== "é»‘åå•æ ¡éªŒå¯¹è±¡"

    ```java
    @Component
    @Order(3) // æ ¡éªŒé¡ºåºæ’ç¬¬3
    public class CheckBlackFilterObject extends AbstractHandler {
        @Override
        void doFilter(int a, int b) {
            System.out.println("æ ¡éªŒé»‘åå•");
        }
    }
    ```

=== "è§„åˆ™æ‹¦æˆªå¯¹è±¡"

    ```java
    @Component
    @Order(4) // æ ¡éªŒé¡ºåºæ’ç¬¬4
    public class CheckRuleFilterObject extends AbstractHandler {
        @Override
        void doFilter(int a, int b) {
            System.out.println("å†…éƒ¨è§„åˆ™");
        }
    }
    ```

æœ€åå°±æ˜¯å°†å®ƒä»¬æ”¾åˆ°listé‡Œé¢ï¼Œä¾¿åˆ©ä¸€ä¸‹æ‰§è¡Œå°±å¯ä»¥äº†ã€‚

```java
@Component("ChainPatternDemo")
public class ChainPatternDemo {
    // è‡ªåŠ¨æ³¨å…¥å„ä¸ªè´£ä»»é“¾çš„å¯¹è±¡
    @Autowired
    private List<AbstractHandler> abstractHandleList;

    @Getter
    @Setter
    private AbstractHandler abstractHandler;

    // springæ³¨å…¥åè‡ªåŠ¨æ‰§è¡Œï¼Œè´£ä»»é“¾çš„å¯¹è±¡è¿æ¥èµ·æ¥
    @PostConstruct
    public void initializeChainFilter() {
        for (int i = 0; i < abstractHandleList.size(); i++) {
            if (i == 0) {
                abstractHandler = abstractHandleList.get(0);
            } else {
                AbstractHandler currentHander = abstractHandleList.get(i - 1);
                AbstractHandler nextHander = abstractHandleList.get(i);
                currentHander.setNextHandler(nextHander);
            }
        }
    }

    // ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä½¿ç”¨
    public String exec(int a, int b) {
        abstractHandler.filter(a, b);
        return "è¿”å›ä½ æƒ³è¿”å›çš„ä¸œè¥¿,åœ¨è´£ä»»é“¾èµ°å®Œå";
    }
}
```

### ğŸ”ä½¿ç”¨æ–¹å¼

é‚£é‡Œè¦æ ¡éªŒï¼Œå°±ç›´æ¥æ³¨å…¥è¿™ä¸ªdemoï¼Œèµ°ä¸€ä¸‹`exec()`æ–¹æ³•å°±è¡Œäº†ã€‚è¿™ä¸ªå‚æ•°çœ‹éœ€æ±‚æ·»åŠ ã€‚

```java
@RequestMapping
@RestController
@RequiredArgsConstructor
public class TestDutyChain {
    private final ChainPatternDemo chainPatternDemo;
    
    @PostMapping("/xxx")
    public void test(Example example) {
        chainPatternDemo.exec(example.arg1, example.arg2);
    }
}
```
